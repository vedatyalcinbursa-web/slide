<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive API Otomatik Slayt Gösterisi</title>
    <style>
        /* CSS: Tam Ekran ve Resim Stilleri */
        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
        }

        .slideshow-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .mySlides {
            display: none;
            width: 100%;
            height: 100%;
        }

        .mySlides img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Resmi, en boy oranını koruyarak sığdırır */
        }
        
        #auth-button, #fullscreen-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 5px;
            z-index: 10;
            transition: opacity 0.3s;
        }
        
        #fullscreen-button {
            top: 60%; /* Daha aşağıda göster */
        }

        #status-message {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 3px;
        }
    </style>
</head>
<body>

<div class="slideshow-container">
    <div id="status-message">Yükleniyor...</div>
    <button id="auth-button" style="display: none;">Google Drive'a Erişime İzin Ver</button>
    <button id="fullscreen-button" style="display: none;">Tam Ekran Başlat</button>
</div>

<script src="https://apis.google.com/js/api.js"></script>

<script>
    // ----------------------------------------------------------------------
    // 1. KONFİGÜRASYON (LÜTFEN KENDİ BİLGİLERİNİZLE DEĞİŞTİRİN)
    // ----------------------------------------------------------------------
    const CLIENT_ID = '434808804534-3dtkh0g3j9a7784rf3dtgcik3o4e8t6s.apps.googleusercontent.com'; 
    const API_KEY = 'AIzaSyACBFEhkivz-i0vvZse5fm-dmRMdy2Yi0I';
    const FOLDER_ID = '12gBh-NvGWh2s-akmSHCdwvorZklC14dx'; // Resimlerin bulunduğu klasör ID'si
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.email';
    const SLIDE_DURATION = 4000; // Slaytlar arası geçiş süresi (5 saniye)
    // ----------------------------------------------------------------------

    let isAuthorized = false;
    let slideIndex = 0;
    const container = document.querySelector('.slideshow-container');
    const authButton = document.getElementById('auth-button');
    const fullscreenButton = document.getElementById('fullscreen-button');
    const statusMessage = document.getElementById('status-message');

    // API kütüphanesini yükle
    gapi.load('client:auth2', initClient);

    function initClient() {
        gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            discoveryDocs: DISCOVERY_DOCS,
            scope: SCOPES
        }).then(() => {
            // Oturum durumunu dinlemeye başla
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
            // İlk oturum durumunu kontrol et
            updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        }, (error) => {
            statusMessage.textContent = 'Hata: API başlatılamadı. Kodları kontrol edin.';
        });
    }

    function updateSigninStatus(isSignedIn) {
        isAuthorized = isSignedIn;
        if (isSignedIn) {
            authButton.style.display = 'none';
            statusMessage.textContent = 'Drive bağlantısı kuruldu. Resimler yükleniyor...';
            listFiles();
        } else {
            // Yetkilendirme gerekiyorsa butonu göster
            statusMessage.textContent = 'Lütfen Google Drive erişimi için izin verin.';
            authButton.style.display = 'block';
            authButton.onclick = handleAuthClick;
        }
    }

    function handleAuthClick() {
        gapi.auth2.getAuthInstance().signIn();
    }

    function listFiles() {
        // Resimleri (mimeType 'image/' içeren dosyaları) klasör ID'sine göre filtrele
        const query = `'${FOLDER_ID}' in parents and mimeType contains 'image/' and trashed = false`;
        
        gapi.client.drive.files.list({
            'pageSize': 100, 
            'fields': 'files(id, name)', // Sadece ID ve Name alınıyor, Web Content Link doğrudan kullanılamaz.
            'q': query
        }).then(response => {
            const files = response.result.files;
            if (files && files.length > 0) {
                renderSlideshow(files);
            } else {
                statusMessage.textContent = 'Klasörde resim bulunamadı.';
            }
        }, error => {
            statusMessage.textContent = 'Hata: Dosya listesi çekilemedi. Yetkilerinizi kontrol edin.';
            console.error(error);
        });
    }
    
    function renderSlideshow(files) {
        // Eski yükleme mesajını kaldır
        statusMessage.style.display = 'none';
        
        files.forEach(file => {
            const slideDiv = document.createElement('div');
            slideDiv.classList.add('mySlides');
            const img = document.createElement('img');
            
            // Dosya ID'si üzerinden doğrudan indirme/görüntüleme bağlantısı oluşturulur.
            // Bu, yetkili kullanıcı için çalışır.
            img.src = `https://drive.google.com/uc?export=download&id=${file.id}`;
            img.alt = file.name;
            
            slideDiv.appendChild(img);
            container.appendChild(slideDiv);
        });
        
        // Slayt gösterisini başlat
        showSlides();
        
        // Tam ekran butonu göster
        fullscreenButton.style.display = 'block';
        fullscreenButton.onclick = openFullscreen;
    }

    function showSlides() {
        const slides = document.getElementsByClassName("mySlides");
        if (slides.length === 0) return;

        // Tüm slaytları gizle
        for (let i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }

        // Bir sonraki slayta geç ve döngüye al
        slideIndex++;
        if (slideIndex > slides.length) {
            slideIndex = 1;
        }

        // Aktif slaytı göster
        slides[slideIndex - 1].style.display = "block";

        // Otomatik geçişi ayarla
        setTimeout(showSlides, SLIDE_DURATION);
    }
    
    function openFullscreen() {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
        fullscreenButton.style.display = 'none';
    }

</script>

</body>
</html>